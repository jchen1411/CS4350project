package PomonaTransitSystem;

import java.sql.*;
import java.util.Scanner;

public class PomonaTransitSystem {
    public static void main(String[] args) {
        System.out.println("Connecting to MS Access database...");

        // Check connectivity
        if (DatabaseConnectivity.checkConnection()) {
            System.out.println("Connection successful.");
            
            TripSchedule.displaySchedule("LA", "NY", "2024-8-2");//correct format "YYYY-MM-DD"
            
            
        } else {
            System.out.println("Failed to connect to the database.");
        }
    }

    // Inner class for checking database connectivity
    static class DatabaseConnectivity {
        private static final String DATABASE_URL = "jdbc:ucanaccess://./resources/pomonaTransitSystem.accdb";

        public static boolean checkConnection() {
            try (Connection connection = DriverManager.getConnection(DATABASE_URL)) {
                return connection != null;
            } catch (SQLException e) {
                e.printStackTrace();
                return false;
            }
        }
    }

    // Inner class for database utility functions
    //test
    /**static class DatabaseUtility {
        private static final String DATABASE_URL = "jdbc:ucanaccess://./resources/pomonaTransitSystem.accdb";
        public static void displayTableContents(String tableName) {
            try (Connection connection = DriverManager.getConnection(DATABASE_URL);
                 Statement statement = connection.createStatement();
                 ResultSet resultSet = statement.executeQuery("SELECT * FROM " + tableName)) {
                while (resultSet.next()) {
                    int id = resultSet.getInt("TripNumber");
                    String name = resultSet.getString("StartLocationName");
                    System.out.println("ID: " + id + ", Name: " + name);
                }
            } catch (SQLException e) {
                e.printStackTrace();
            }
        }
    }**/
    
    static class TripSchedule {
        private static final String DATABASE_URL = "jdbc:ucanaccess://./resources/pomonaTransitSystem.accdb";
        
        public static void displaySchedule(String startLocationName, String destinationName, String date) {
            String query = "SELECT TripOffering.TripNumber, TripOffering.Date, TripOffering.ScheduledStartTime, TripOffering.ScheduledArrivalTime, " +
                    "TripOffering.DriverName, TripOffering.BusID " +
                    "FROM TripOffering " +
                    "JOIN Trip ON TripOffering.TripNumber = Trip.TripNumber " +
                    "WHERE Trip.StartLocationName = ? AND Trip.DestinationName = ? AND TripOffering.Date = ?";

            try (Connection connection = DriverManager.getConnection(DATABASE_URL);
                 PreparedStatement preparedStatement = connection.prepareStatement(query)) {

                preparedStatement.setString(1, startLocationName);
                preparedStatement.setString(2, destinationName);
                preparedStatement.setDate(3, Date.valueOf(date));

                try (ResultSet resultSet = preparedStatement.executeQuery()) {
                    System.out.println("Schedule for trips from " + startLocationName + " to " + destinationName + " on " + date + ":");

                    boolean hasResults = false;
                    while (resultSet.next()) {
                        hasResults = true;
                        int tripNumber = resultSet.getInt("TripNumber");
                        String scheduledStartTime = resultSet.getString("ScheduledStartTime").split("\\.")[0];
                        String scheduledArrivalTime = resultSet.getString("ScheduledArrivalTime").split("\\.")[0];
                        String driverName = resultSet.getString("DriverName");
                        int busID = resultSet.getInt("BusID");

                        System.out.println("TripNumber: " + tripNumber + ", ScheduledStartTime: " + scheduledStartTime +
                                ", ScheduledArrivalTime: " + scheduledArrivalTime + ", DriverName: " + driverName + ", BusID: " + busID);
                    }
                    if (!hasResults) {
                        System.out.println("No trips found for the given criteria.");
                    }
                }
            } catch (SQLException e) {
                e.printStackTrace();
            }
        }
    }
    
    
    
    
}